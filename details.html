<html>
<head>
    <meta charset="utf-8">
    <title>Weather</title>
    <!-- Sets initial viewport load and disables zooming  -->
    <meta name="viewport" content="initial-scale=1, maximum-scale=1, user-scalable=no">
    <link rel="stylesheet" href="resc/css/ionic.css">
    <link rel="stylesheet" href="resc/spinner/waitMe.min.css">
    <script type="text/javascript" src="resc/js/jquery.min.js"></script>
    <script type="text/javascript" src="resc/spinner/waitMe.min.js"></script>
    <script type="text/javascript" src="resc/js/jquery.query.string.js"></script>
    <script src="phonegap.js" type="text/javascript"></script>
    <script type="text/javascript">

        var dbName = 'com.amc.documents.database';
        var dbDescription = 'Amc Documents Database.';
        var dbSize = (5 * 1024 * 1024);

        document.addEventListener("deviceready", onDeviceReady, false);

        function onDeviceReady() {
            $(".ionic-body").waitMe({
                effect: 'ios',
                text: 'Please wait',
                bg: 'rgba(255,255,255,0.7)',
                color: '#000'
            });

            var id = getParameterByName("id");

            if (parseInt(id) > 0) {

                html5sql.openDatabase(dbName, dbDescription, dbSize);

                html5sql.process(
                 [
                    "SELECT * FROM DealersEnteries where EnteryId = " + id
                 ],
                 function (transaction, results, rowsArray) {
                     var len = rowsArray.length, i;

                     $("#dvList").append('<label class="item">');
                     $("#dvList").append('<b>' + rowsArray[0].EnteryName + '</b>');
                     $("#dvList").append('</label>');
                     $("#dvList").append('<label class="item">');
                     $("#dvList").append('<div class="row"><div class="col">' + rowsArray[0].BillingDate + '</div><div class="col">' + rowsArray[0].BillingAmt + '</div></div>');
                     $("#dvList").append('</label>');

                     html5sql.process(
                     [
                        "SELECT * FROM DealersDocs where EnteryId = " + id
                     ],
                     function (transactionInner, resultsInner, rowsArrayInner) {
                         var lenInner = rowsArrayInner.length, iInner;
                         for (var i = 0; i < lenInner; i++) {
                             $("#dvList").append('<label class="item item-image">');
                             $("#dvList").append('<img src="data:image/jpeg;base64,' + rowsArrayInner[i].DocName + '" title="' + rowsArrayInner[i].DocTitle + '"  style="padding:10px;" class="docPicture"/>');
                             $("#dvList").append('</label>');
                         }

                         $('.ionic-body').waitMe('hide');
                     },
                     function (error, statement) {
                         showMessage("Error: " + error.message + " when processing " + statement);
                         $('.ionic-body').waitMe('hide');
                     });
                 },
                 function (error, statement) {
                     showMessage("Error: " + error.message + " when processing " + statement);
                     $('.ionic-body').waitMe('hide');
                 });
            }
            else {
                showMessage('There is problem with your last request, please go back and try agin');
            }
        }

        function showMessage(error) {
            navigator.notification.alert(
                error,
                function () { },
                'AMC Documents',
                'Ok'
            );
        }

    </script>
</head>
<body>
    <div class="ionic-body">
        <div class="bar bar-header bar-positive">
            <a class="button icon ion-home" href="index.html"></a>
            <h1 class="title">
                &nbsp;&nbsp;AMC Documents</h1>
            <a class="button icon ion-help" href="help.html"></a>
        </div>
        <div class="content has-header has-footer padding" style="overflow: scroll; height: 100%;"
            id="container">
            <div class="list" id="dvList">
            </div>
            <br />
            <div class="list">
                <label class="item">
                    <a href="#" class="button button-full icon icon-left ion-share">Upload Document</a>
                </label>
            </div>
            <br />
            <br />
        </div>
        <div class="tabs tabs-positive tabs-icon-top">
            <a class="tab-item" href="index.html"><i class="icon ion-home" style="font-size: 25px;">
            </i>Home</a> <a class="tab-item" href="#"><i class="icon ion-ios7-information" style="font-size: 25px;">
            </i>Add Document</a> <a class="tab-item" href="#"><i class="icon ion-ios7-bookmarks"
                style="font-size: 25px;"></i>View Documents</a>
        </div>
    </div>
</body>
</html>
